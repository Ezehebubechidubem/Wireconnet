<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WireConnect ‚Äî Admin Dashboard</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#ffffff; --accent:#0b5cff; --muted:#6b7280;
      --success:#16a34a; --danger:#ef4444; --warn:#f59e0b;
      --shadow: 0 8px 30px rgba(16,24,40,0.06);
      --accent-2:#0738d6;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial, sans-serif}
    body{margin:0;background:var(--bg);color:#0b1220}
    .layout{display:flex;min-height:100vh}
    aside{
      width:340px;padding:18px;border-right:1px solid #e8eef8;background:#fff;
      transition:transform .18s ease;box-shadow:0 0 0 rgba(0,0,0,0);
    }
    aside.hidden{transform:translateX(-120%);position:fixed;z-index:1200;left:0;top:0;height:100%}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:12px}
    .brand img{height:48px;width:auto}
    .nav{display:flex;flex-direction:column;gap:6px;margin-top:12px}
    .nav a{display:flex;gap:8px;align-items:center;padding:10px;border-radius:8px;text-decoration:none;color:#0b1220;font-weight:700;cursor:pointer}
    .nav a:hover{background:#f3f7ff}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid #eef3fb;background:#fff}
    .hamburger{display:block;font-size:20px;cursor:pointer;padding:6px 8px;border-radius:8px}
    main{flex:1;padding:18px}
    .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:14px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:var(--shadow)}
    .metric-title{font-size:13px;color:var(--muted)}
    .metric-value{font-size:20px;font-weight:800;margin-top:6px}
    .panel{margin-bottom:12px}
    .controls{display:flex;gap:8px;align-items:center}
    .search{padding:8px;border-radius:8px;border:1px solid #e6eef9}
    .btn{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #eef3fb;text-align:left;font-size:13px}
    .muted{color:var(--muted);font-size:13px}
    .empty{color:var(--muted);padding:10px}
    .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:1100}
    .popup{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;padding:14px;border-radius:10px;box-shadow:0 12px 40px rgba(10,20,40,0.24);z-index:1200;width:min(900px,96%)}
    .small{font-size:13px;color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:8px;font-weight:700;font-size:12px}
    .badge-pending{background:linear-gradient(90deg,#fff7ed,#fff2cc);color:#92400e;border:1px solid #f8d7a8}
    .badge-accepted{background:linear-gradient(90deg,#ecfdf5,#bbf7d0);color:#065f46;border:1px solid #bbf7d0}
    .badge-declined{background:linear-gradient(90deg,#fff1f2,#ffd7d9);color:#991b1b;border:1px solid #fca5a5}
    .row{display:flex;gap:8px;align-items:center}
    .sidebar-close{display:inline-block;padding:6px 8px;border-radius:8px;background:#f3f4f6;border:1px solid #e6eef9;cursor:pointer}
    @media(max-width:920px){ .metrics{grid-template-columns:repeat(2,1fr)} .hamburger{display:block} }
    input,select,textarea{padding:8px;border-radius:8px;border:1px solid #eef3fb;width:100%;box-sizing:border-box}
    .small-btn{padding:6px 10px;border-radius:8px;border:1px solid #e6eef9;background:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  <div class="popup" id="popup">
    <div id="popupMessage"></div>
    <div style="text-align:right;margin-top:12px"><button id="popupClose" class="btn" style="background:#eef3ff;color:var(--accent)">Close</button></div>
  </div>

  <div class="layout">
    <aside id="sidebar" aria-hidden="false">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="brand">
          <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="WireConnect logo">
          <div>
            <div style="font-weight:900">WireConnect</div>
            <div class="muted" style="font-size:12px">Admin Console</div>
          </div>
        </div>
        <button id="sidebarClose" class="sidebar-close" title="Close">‚úï</button>
      </div>

      <nav class="nav" id="menu">
        <a data-panel="overview">üè† Overview</a>
        <a data-panel="kyc">ü™™ KYC Logs</a>
        <a data-panel="jobs">üîß Job Logs</a>
        <a data-panel="users">üë• Users</a>
        <a data-panel="transactions">üí∏ Transactions</a>
        <a data-panel="disputes">‚ö†Ô∏è Disputes</a>
        <a id="logout">üö™ Logout</a>
      </nav>

      <div style="margin-top:14px;color:var(--muted);font-size:13px">
        Logged in as <strong id="adminName">Admin</strong>
        <div style="margin-top:8px">
          <button id="refreshAll" class="btn" style="padding:8px 10px;background:#eef3ff;color:var(--accent)">Refresh</button>
        </div>
      </div>
    </aside>

    <div style="flex:1">
      <header>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="hamburger" id="hamburgerBtn">‚ò∞</div>
          <div>
            <div style="font-weight:900">WireConnect ‚Äî Admin</div>
            <div class="muted" style="font-size:13px">Overview & logs</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="muted" id="lastUpdated">Last updated: ‚Äî</div>
        </div>
      </header>

      <main>
        <section class="metrics" aria-live="polite">
          <div class="card">
            <div class="metric-title">Technicians online</div>
            <div id="onlineTech" class="metric-value">‚Äî</div>
            <div class="muted">Workers currently marked online</div>
          </div>
          <div class="card">
            <div class="metric-title">Technicians offline</div>
            <div id="offlineTech" class="metric-value">‚Äî</div>
            <div class="muted">Workers currently offline</div>
          </div>
          <div class="card">
            <div class="metric-title">Clients online</div>
            <div id="onlineClient" class="metric-value">‚Äî</div>
            <div class="muted">Clients currently online</div>
          </div>
          <div class="card">
            <div class="metric-title">Clients offline</div>
            <div id="offlineClient" class="metric-value">‚Äî</div>
            <div class="muted">Clients currently offline</div>
          </div>
        </section>

        <section id="contentArea" class="panel card">
          <div id="panelHeader" style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong id="panelTitle">Overview</strong>
              <div class="muted" id="panelSubtitle">Quick summary</div>
            </div>
            <div class="controls">
              <input id="panelSearch" class="search" placeholder="Search (job id or user id)" />
              <button id="panelRefresh" class="btn">Refresh</button>
            </div>
          </div>

          <div id="panelBody" style="margin-top:12px">
            <div id="overview" class="panelSection">
              <div style="display:flex;gap:12px;flex-wrap:wrap">
                <div class="card" style="flex:1;min-width:260px">
                  <strong>KYC activity (quick)</strong>
                  <div id="overviewKyc" style="margin-top:8px" class="muted">Loading‚Ä¶</div>
                </div>
                <div class="card" style="flex:1;min-width:260px">
                  <strong>Recent jobs</strong>
                  <div id="overviewJobs" style="margin-top:8px" class="muted">Loading‚Ä¶</div>
                </div>
                <div class="card" style="flex:1;min-width:260px">
                  <strong>Notes</strong>
                  <div class="muted" style="margin-top:8px">Use the KYC, Jobs, Users sections for detailed logs. Colors: yellow = pending, green = accepted/verified, red = declined/issue.</div>
                </div>
              </div>
            </div>

            <div id="kyc" class="panelSection" style="display:none">
              <h3 style="margin:0 0 8px 0">KYC Logs</h3>
              <div class="muted">Recent KYC activities (includes uploaded images).</div>
              <table id="kycTable" style="margin-top:12px">
                <thead><tr><th>ID</th><th>User</th><th>Type</th><th>Submitted</th><th>Status</th><th>Images</th></tr></thead>
                <tbody><tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr></tbody>
              </table>
            </div>

            <div id="jobs" class="panelSection" style="display:none">
              <h3 style="margin:0 0 8px 0">Job Logs</h3>
              <div class="muted">Recent job creations and assignments.</div>
              <table id="jobTable" style="margin-top:12px">
                <thead><tr><th>ID</th><th>Type</th><th>Price</th><th>Client ‚Üí Tech</th><th>Status</th><th>Created</th></tr></thead>
                <tbody><tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr></tbody>
              </table>
            </div>

            <div id="users" class="panelSection" style="display:none">
              <h3 style="margin:0 0 8px 0">Users</h3>
              <div class="muted">List users (filter by role/online)</div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <select id="userRoleFilter"><option value="">All roles</option><option value="client">Clients</option><option value="worker">Technicians</option></select>
                <select id="userOnlineFilter"><option value="">All</option><option value="1">Online</option><option value="0">Offline</option></select>
                <button id="loadUsersBtn" class="small-btn">Load</button>
              </div>
              <table id="usersTable" style="margin-top:12px">
                <thead><tr><th>ID</th><th>Name</th><th>Role</th><th>Online</th><th>Location</th><th>Action</th></tr></thead>
                <tbody><tr><td colspan="6" class="empty">No data</td></tr></tbody>
              </table>
            </div>

            <div id="transactions" class="panelSection" style="display:none">
              <h3 style="margin:0 0 8px 0">Transactions</h3>
              <div class="muted">Recent transactions (if enabled).</div>
              <table id="transactionsTable" style="margin-top:12px">
                <thead><tr><th>ID</th><th>Job</th><th>Amount</th><th>Client</th><th>Tech</th><th>Status</th></tr></thead>
                <tbody><tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr></tbody>
              </table>
            </div>

            <div id="disputes" class="panelSection" style="display:none">
              <h3 style="margin:0 0 8px 0">Disputes</h3>
              <div class="muted">Open disputes (if enabled)</div>
              <table id="disputesTable" style="margin-top:12px">
                <thead><tr><th>ID</th><th>Job</th><th>Claimant</th><th>Defendant</th><th>Reason</th><th>Status</th></tr></thead>
                <tbody><tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr></tbody>
              </table>
            </div>

          </div>
        </section>
      </main>
    </div>
  </div>

<script>
(function(){
  const API_BASE = (location.hostname.includes('localhost') ? 'http://localhost:10000' : (location.origin.includes('localhost') ? 'http://localhost:10000' : 'https://wireconnet-1.onrender.com'));
  const adminToken = localStorage.getItem('wc_admin_token') || localStorage.getItem('wc_token') || null;

  // UI refs
  const sidebar = document.getElementById('sidebar');
  const hamburgerBtn = document.getElementById('hamburgerBtn');
  const sidebarClose = document.getElementById('sidebarClose');
  const overlay = document.getElementById('overlay');
  const popup = document.getElementById('popup');
  const popupClose = document.getElementById('popupClose');
  const lastUpdated = document.getElementById('lastUpdated');
  const refreshAll = document.getElementById('refreshAll');
  const panelRefresh = document.getElementById('panelRefresh');

  const onlineTechEl = document.getElementById('onlineTech');
  const offlineTechEl = document.getElementById('offlineTech');
  const onlineClientEl = document.getElementById('onlineClient');
  const offlineClientEl = document.getElementById('offlineClient');

  // panel nav
  document.querySelectorAll('#menu a[data-panel]').forEach(a => a.addEventListener('click', (e)=>{
    e.preventDefault();
    openPanel(a.getAttribute('data-panel'));
  }));

  function openPanel(name){
    document.querySelectorAll('.panelSection').forEach(s => s.style.display = 'none');
    const el = document.getElementById(name);
    if(el) el.style.display = 'block';
    document.getElementById('panelTitle').innerText = name[0].toUpperCase() + name.slice(1);
    const subtitles = {
      overview:'Quick summary',
      kyc:'Recent KYC requests',
      jobs:'Recent jobs',
      users:'User listing',
      transactions:'Transactions',
      disputes:'Disputes'
    };
    document.getElementById('panelSubtitle').innerText = subtitles[name] || '';
    window.__panel = name;
    // load relevant data
    if(name === 'overview') loadOverview();
    if(name === 'kyc') loadKyc();
    if(name === 'jobs') loadJobs();
    if(name === 'users') {}; // wait for user action
    if(name === 'transactions') loadTransactions();
    if(name === 'disputes') loadDisputes();
  }

  // hamburger open / close with X only
  hamburgerBtn.addEventListener('click', ()=> {
    sidebar.classList.toggle('hidden');
    sidebar.setAttribute('aria-hidden', sidebar.classList.contains('hidden') ? 'true' : 'false');
  });
  sidebarClose.addEventListener('click', ()=> {
    sidebar.classList.add('hidden');
    sidebar.setAttribute('aria-hidden','true');
  });

  // fetch helper
  async function apiFetch(path, opts = {}) {
    const headers = Object.assign({}, opts.headers || {});
    if(adminToken) headers['Authorization'] = 'Bearer ' + adminToken;
    try{
      const res = await fetch(API_BASE + path, Object.assign({ headers }, opts));
      const text = await res.text().catch(()=>null);
      let body=null;
      try{ body = text ? JSON.parse(text) : null; }catch(e){}
      return { ok: res.ok, status: res.status, text, body };
    }catch(e){ return { ok:false, error:String(e) }; }
  }

  // metrics
  async function loadOverview(){
    // Call new metrics endpoint first, fallback if missing to manual queries
    const m = await apiFetch('/api/admin/metrics');
    if(m.ok && m.body && m.body.success){
      const mm = m.body.metrics || {};
      onlineTechEl.innerText = mm.online_tech_count ?? '‚Äî';
      offlineTechEl.innerText = mm.offline_tech_count ?? '‚Äî';
      onlineClientEl.innerText = mm.online_client_count ?? '‚Äî';
      offlineClientEl.innerText = mm.offline_client_count ?? '‚Äî';
    } else {
      // fallback: best-effort via /api/admin/users (if exists)
      onlineTechEl.innerText = 'N/A'; offlineTechEl.innerText='N/A'; onlineClientEl.innerText='N/A'; offlineClientEl.innerText='N/A';
    }

    // KYC & Jobs quick info
    const ky = await apiFetch('/api/admin/kyc-logs?limit=5');
    document.getElementById('overviewKyc').innerHTML = (ky.ok && ky.body && Array.isArray(ky.body.logs)) ? `${ky.body.logs.length} recent ‚Äî <a href="#" onclick="openPanel('kyc');return false">Open KYC</a>` : '‚Äî';
    const jb = await apiFetch('/api/admin/job-logs?limit=5');
    document.getElementById('overviewJobs').innerHTML = (jb.ok && jb.body && Array.isArray(jb.body.jobs)) ? `${jb.body.jobs.length} recent ‚Äî <a href="#" onclick="openPanel('jobs');return false">Open Jobs</a>` : '‚Äî';
    lastUpdated.innerText = 'Last updated: ' + (new Date()).toLocaleString();
  }

  // KYC logs
  async function loadKyc(){
    const tbody = document.querySelector('#kycTable tbody');
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr>`;
    const r = await apiFetch('/api/admin/kyc-logs?limit=100');
    if(r.ok && r.body && Array.isArray(r.body.logs)){
      const rows = r.body.logs;
      if(rows.length === 0){ tbody.innerHTML = `<tr><td colspan="6" class="empty">No records</td></tr>`; return; }
      tbody.innerHTML = rows.map(it => {
        const status = (it.status||'').toLowerCase();
        const badge = status === 'pending' ? `<span class="badge badge-pending">PENDING</span>` :
                      (status === 'approved' || status === 'verified') ? `<span class="badge badge-accepted">VERIFIED</span>` :
                      (status === 'declined' || status === 'rejected') ? `<span class="badge badge-declined">DECLINED</span>` :
                      `<span class="badge">${escapeHtml(it.status||'')}</span>`;
        const imgs = Array.isArray(it.id_images) && it.id_images.length ? it.id_images.slice(0,3).map(u=>`<a href="${escapeHtml(u)}" target="_blank" style="margin-right:6px">img</a>`).join(' ') : '-';
        return `<tr>
          <td>${escapeHtml(it.id)}</td>
          <td>${escapeHtml(it.fullname || it.username || it.user_id || '‚Äî')}</td>
          <td>${escapeHtml(it.id_type || '-')}</td>
          <td>${new Date(it.submitted_at || Date.now()).toLocaleString()}</td>
          <td>${badge}</td>
          <td>${imgs}</td>
        </tr>`;
      }).join('');
      return;
    }
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Failed to load KYC (${r.status||r.error})</td></tr>`;
  }

  // Jobs logs
  async function loadJobs(){
    const tbody = document.querySelector('#jobTable tbody');
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr>`;
    const r = await apiFetch('/api/admin/job-logs?limit=100');
    if(r.ok && r.body && Array.isArray(r.body.jobs)){
      const rows = r.body.jobs;
      if(rows.length === 0){ tbody.innerHTML = `<tr><td colspan="6" class="empty">No jobs</td></tr>`; return; }
      tbody.innerHTML = rows.map(j => {
        const status = (j.status||'').toLowerCase();
        const badge = status === 'created' || status === 'pending_assignment' ? `<span class="badge badge-pending">${escapeHtml(j.status)}</span>` :
                      status === 'accepted' || status === 'completed' ? `<span class="badge badge-accepted">${escapeHtml(j.status)}</span>` :
                      `<span class="badge badge-declined">${escapeHtml(j.status)}</span>`;
        const client = escapeHtml(j.client_name || j.client_id || '-');
        const tech = escapeHtml(j.tech_name || j.tech_id || '-');
        return `<tr>
          <td>${escapeHtml(j.id)}</td>
          <td>${escapeHtml(j.job_type||'-')}</td>
          <td>‚Ç¶${(j.price || 0).toLocaleString()}</td>
          <td>${client} ‚Üí ${tech}</td>
          <td>${badge}</td>
          <td>${new Date(j.created_at).toLocaleString()}</td>
        </tr>`;
      }).join('');
      return;
    }
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Failed to load jobs (${r.status||r.error})</td></tr>`;
  }

  // Users load with filters
  document.getElementById('loadUsersBtn').addEventListener('click', loadUsers);
  async function loadUsers(){
    const role = document.getElementById('userRoleFilter').value;
    const online = document.getElementById('userOnlineFilter').value;
    const params = new URLSearchParams();
    if(role) params.set('role', role);
    if(online !== '') params.set('online', online);
    params.set('limit', '200');
    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr>`;
    const r = await apiFetch('/api/admin/users?' + params.toString());
    if(r.ok && r.body && Array.isArray(r.body.users)){
      const rows = r.body.users;
      if(rows.length === 0){ tbody.innerHTML = `<tr><td colspan="6" class="empty">No users</td></tr>`; return; }
      tbody.innerHTML = rows.map(u => {
        const onlineText = u.online ? '<span style="color:var(--success)">Yes</span>' : '<span style="color:#666">No</span>';
        const location = escapeHtml((u.city||'') + (u.state ? ', ' + u.state : ''));
        return `<tr>
          <td>${escapeHtml(u.id)}</td>
          <td>${escapeHtml(u.fullname || u.username || u.email || '-')}</td>
          <td>${escapeHtml(u.role || '-')}</td>
          <td>${onlineText}</td>
          <td>${location}</td>
          <td><button class="small-btn" data-id="${escapeHtml(u.id)}" onclick="setOnlineLocal('${escapeHtml(u.id)}', true)">Set Online</button>
              <button class="small-btn" data-id="${escapeHtml(u.id)}" onclick="setOnlineLocal('${escapeHtml(u.id)}', false)">Set Offline</button></td>
        </tr>`;
      }).join('');
      return;
    }
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Failed to load users (${r.status||r.error})</td></tr>`;
  }

  // expose setOnlineLocal globally for inline onclick usage
  window.setOnlineLocal = async function(uid, onlineFlag){
    if(!uid) return alert('Missing user id');
    const body = { techId: uid, online: !!onlineFlag, lat: null, lng: null };
    const r = await apiFetch('/api/tech/status', { method:'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
    if(r.ok && r.body && r.body.success){ alert('Updated'); loadUsers(); loadOverview(); } else alert('Failed to update status: ' + (r.body && r.body.message ? r.body.message : (r.status||r.error)));
  };

  // transactions
  async function loadTransactions(){
    const tbody = document.querySelector('#transactionsTable tbody');
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr>`;
    const r = await apiFetch('/api/admin/transactions?limit=50');
    if(r.ok && r.body && Array.isArray(r.body.transactions)){
      const rows = r.body.transactions;
      if(rows.length===0){ tbody.innerHTML = `<tr><td colspan="6" class="empty">No transactions</td></tr>`; return; }
      tbody.innerHTML = rows.map(t => `<tr>
        <td>${escapeHtml(t.id)}</td>
        <td>${escapeHtml(t.job_id||'-')}</td>
        <td>‚Ç¶${Number(t.amount||0).toLocaleString()}</td>
        <td>${escapeHtml(t.client_name||t.client_id||'-')}</td>
        <td>${escapeHtml(t.tech_name||t.tech_id||'-')}</td>
        <td>${escapeHtml(t.status||'-')}</td>
      </tr>`).join('');
      return;
    }
    tbody.innerHTML = `<tr><td colspan="6" class="empty">No transactions endpoint / failed (${r.status||r.error})</td></tr>`;
  }

  // disputes
  async function loadDisputes(){
    const tbody = document.querySelector('#disputesTable tbody');
    tbody.innerHTML = `<tr><td colspan="6" class="empty">Loading‚Ä¶</td></tr>`;
    const r = await apiFetch('/api/admin/disputes?limit=50');
    if(r.ok && r.body && Array.isArray(r.body.disputes)){
      const rows = r.body.disputes;
      if(rows.length===0){ tbody.innerHTML = `<tr><td colspan="6" class="empty">No disputes</td></tr>`; return; }
      tbody.innerHTML = rows.map(d => `<tr>
        <td>${escapeHtml(d.id)}</td>
        <td>${escapeHtml(d.job_id||'-')}</td>
        <td>${escapeHtml(d.claimant_name||d.claimant_id||'-')}</td>
        <td>${escapeHtml(d.defendant_name||d.defendant_id||'-')}</td>
        <td>${escapeHtml((d.reason||'').slice(0,80))}</td>
        <td>${escapeHtml(d.status||'-')}</td>
      </tr>`).join('');
      return;
    }
    tbody.innerHTML = `<tr><td colspan="6" class="empty">No disputes endpoint / failed (${r.status||r.error})</td></tr>`;
  }

  // initial load and refresh handlers
  document.getElementById('panelRefresh').addEventListener('click', ()=> { const panel = window.__panel || 'overview'; openPanel(panel); });
  document.getElementById('refreshAll').addEventListener('click', ()=> { loadOverview(); const panel = window.__panel || 'overview'; openPanel(panel); });

  openPanel('overview');
  loadOverview();
  setInterval(loadOverview, 20_000);

  // popup
  popupClose.addEventListener('click', ()=> { popup.style.display='none'; overlay.style.display='none'; });

  // logout
  document.getElementById('logout').addEventListener('click', ()=> {
    localStorage.removeItem('wc_admin_token'); localStorage.removeItem('wc_token'); alert('Logged out'); location.reload();
  });

  // escape helper
  function escapeHtml(str){ if(!str && str !== 0) return ''; return String(str).replace(/[&<>"'`=\/]/g, function(ch){ return ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;' })[ch]; }); }
})();
</script>
</body>
</html>