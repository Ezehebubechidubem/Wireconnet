<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WireConnect — Dashboard</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --accent:#0b5cff; --muted:#6b7280;
      --surface:#ffffff; --shadow: 0 8px 30px rgba(16,24,40,0.06);
      --radius:12px;
    }
    html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:#111827;-webkit-font-smoothing:antialiased}
    .wrap{max-width:980px;margin:18px auto;padding:14px}
    /* HEADER - logo full width, menu button to the right */
    header{display:flex;align-items:center;gap:12px}
    .logo{
      flex:1; display:flex;align-items:center;gap:12px;background:linear-gradient(135deg,#0b5cff,#55a7ff);
      border-radius:10px;padding:8px 12px;color:white;box-shadow:0 8px 24px rgba(11,92,255,0.08);
      height:56px;box-sizing:border-box;
    }
    .logo img{height:40px; object-fit:contain}
    .menu-btn{
      width:54px;height:54px;border-radius:10px;border:0;background:#0b5cff;color:white;display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 18px rgba(11,92,255,0.12);cursor:pointer;font-weight:700;
    }
    main.card{background:var(--card);border-radius:var(--radius);padding:14px;margin-top:12px;box-shadow:var(--shadow)}
    /* content blocks */
    .section{background:var(--surface);border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 6px 20px rgba(16,24,40,0.04)}
    .section h3{margin:0 0 6px;font-size:16px}
    .top-list{padding:8px 0}
    .top-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,#ffffff,#fbfcff);margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
    /* off-canvas menu */
    .drawer-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;z-index:1000}
    .drawer{position:fixed;right:0;top:0;height:100%;width:320px;max-width:86vw;background:white;box-shadow:-16px 0 40px rgba(2,6,23,0.12);transform:translateX(100%);transition:transform .28s ease;z-index:1001;padding:18px;box-sizing:border-box}
    .drawer.open{transform:translateX(0)}
    .drawer .header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .drawer .logo-small{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#0b5cff,#55a7ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .drawer a{display:block;padding:12px;border-radius:8px;color:#0b0b0b;text-decoration:none;margin-bottom:8px;border:1px solid #f1f5f9;background:#fbfdff}
    .drawer .primary{background:linear-gradient(90deg,#0b5cff,#55a7ff);color:white;border:0}
    .drawer .muted{font-size:13px;color:var(--muted)}
    .toggle-row{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:8px 0}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:#eef3ff;color:var(--accent)}
    /* responsive */
    @media(max-width:720px){
      .drawer{width:92vw}
      .logo img{height:34px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" role="banner" aria-label="WireConnect">
        <!-- exact logo you provided -->
        <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="WireConnect logo">
        <div style="font-weight:700;font-size:15px">WireConnect — Technician Dashboard</div>
      </div>

      <button id="menuBtn" class="menu-btn" aria-label="Open menu">☰</button>
    </header>

    <main class="card" role="main">
      <!-- optional greeting below logo (visible inside page) -->
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <div>
          <div style="font-size:16px;font-weight:700">Welcome back</div>
          <div class="muted" id="userGreeting">Tech — set up your profile</div>
        </div>
        <div class="badge" id="statusBadge">Offline</div>
      </div>

      <!-- Announcements -->
      <section class="section" aria-labelledby="ann">
        <h3 id="ann">Announcements</h3>
        <div class="muted">No new announcements</div>
      </section>

      <!-- Articles -->
      <section class="section" aria-labelledby="news">
        <h3 id="news">Articles & News</h3>
        <div class="muted">Latest industry news will appear here.</div>
      </section>

      <!-- Top Technicians (example) -->
      <section class="section" aria-labelledby="toptech">
        <h3 id="toptech">Top Technicians</h3>
        <div class="top-list" id="leaderboard">
          <div class="top-item"><strong>Ezeh Bonk</strong><div class="muted">Count: 0</div></div>
        </div>
      </section>

      <!-- the Quick Actions were removed from the page body and moved into the Menu as requested -->
      <div class="muted">Quick actions (Go Online/Offline, Profile & KYC, Settings, Quotations) are available inside the Menu (top-right).</div>
    </main>
  </div>

  <!-- Drawer / Menu -->
  <div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Main menu">
    <div class="header">
      <div class="logo-small" aria-hidden="true">
        <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="" style="height:28px;object-fit:contain">
      </div>
      <div>
        <div style="font-weight:700">Quick Menu</div>
        <div class="muted" id="drawerUser">Technician</div>
      </div>
    </div>

    <nav>
      <a href="quotations.html" id="quotationsLink">Quotations</a>
      <a href="profile.html" id="profileLink">Profile & KYC</a>
      <a href="settings.html" id="settingsLink">Settings</a>

      <div style="height:8px"></div>

      <div class="toggle-row" style="align-items:center;">
        <div>
          <div style="font-weight:600">Availability</div>
          <div class="muted">Go online to receive job requests</div>
        </div>
        <div>
          <button id="toggleOnlineBtn" class="primaryToggle" style="padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer">Go Online</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="muted">Other actions</div>
      <a href="#" id="logoutBtn" style="background:#fff;border:1px solid #f1f5f9">Logout</a>

      <div style="height:14px"></div>
      <div class="muted" id="drawerFeedback" style="font-size:13px"></div>
    </nav>
  </aside>

  <script>
    // UI elements
    const menuBtn = document.getElementById('menuBtn');
    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('drawerBackdrop');
    const toggleOnlineBtn = document.getElementById('toggleOnlineBtn');
    const statusBadge = document.getElementById('statusBadge');
    const drawerFeedback = document.getElementById('drawerFeedback');
    const drawerUser = document.getElementById('drawerUser');
    const userGreeting = document.getElementById('userGreeting');

    // backend endpoint to POST online status (optional). Update to your real backend path if different.
    const STATUS_ENDPOINT = (function(){ 
      // try to guess base URL from current host, or replace with your render URL 
      const orig = window.location.origin;
      // if your API is hosted elsewhere, set it explicitly here:
      return (typeof BACKEND_BASE !== 'undefined') ? BACKEND_BASE + '/api/technician/status' : 'https://wireconnet-1.onrender.com/api/technician/status';
    })();

    // open/close drawer
    function openDrawer(){
      drawer.classList.add('open');
      backdrop.style.display = 'block';
      drawer.setAttribute('aria-hidden','false');
      backdrop.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      backdrop.style.display = 'none';
      drawer.setAttribute('aria-hidden','true');
      backdrop.setAttribute('aria-hidden','true');
    }
    menuBtn.addEventListener('click', openDrawer);
    backdrop.addEventListener('click', closeDrawer);

    // read user info from localStorage (if available)
    function loadUser(){
      try {
        const raw = localStorage.getItem('wc_user');
        if(raw){
          const u = JSON.parse(raw);
          drawerUser.textContent = u.fullname || u.username || 'Technician';
          userGreeting.textContent = (u.fullname ? u.fullname : u.username) + ' — ready to work';
        } else {
          drawerUser.textContent = 'Technician';
        }
      } catch(e){
        console.warn('Could not load user info', e);
      }
    }

    // online toggle handling
    function setOnlineUI(isOnline){
      statusBadge.textContent = isOnline ? 'Online' : 'Offline';
      statusBadge.style.background = isOnline ? '#ecfff5' : 'transparent';
      statusBadge.style.color = isOnline ? '#037a50' : 'var(--muted)';
      toggleOnlineBtn.textContent = isOnline ? 'Go Offline' : 'Go Online';
      toggleOnlineBtn.style.background = isOnline ? '#fff' : 'var(--accent)';
      toggleOnlineBtn.style.color = isOnline ? 'var(--accent)' : '#fff';
      toggleOnlineBtn.style.border = isOnline ? '1px solid #e6eef9' : '0';
    }

    async function updateOnlineStatus(on){
      // local quick UI
      setOnlineUI(on);
      drawerFeedback.textContent = (on ? 'Trying to take jobs...' : 'You will not receive jobs while offline.');
      localStorage.setItem('wc_online', on ? '1' : '0');

      // try to notify backend (best-effort)
      const token = localStorage.getItem('wc_token');
      try {
        const resp = await fetch(STATUS_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...(token ? { 'Authorization': 'Bearer ' + token } : {})
          },
          body: JSON.stringify({ online: !!on }),
        });
        if(resp.ok){
          drawerFeedback.textContent = on ? 'You are now online — waiting for job requests.' : 'You are now offline.';
        } else {
          const text = await resp.text().catch(()=>null);
          drawerFeedback.textContent = 'Server response: ' + (text || resp.statusText);
        }
      } catch(err){
        console.warn('Status update failed (server not reachable?)', err);
        drawerFeedback.textContent = 'Network: could not notify server (saved locally).';
      }
    }

    // wire toggle button
    toggleOnlineBtn.addEventListener('click', ()=>{
      const current = localStorage.getItem('wc_online') === '1';
      const want = !current;
      updateOnlineStatus(want);
    });

    // pre-fill UI from stored state
    (function init(){
      loadUser();
      const onlineFlag = localStorage.getItem('wc_online') === '1';
      setOnlineUI(onlineFlag);
      // hide menu if clicked outside or esc
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeDrawer(); });
    })();

    // Logout behavior (simple)
    document.getElementById('logoutBtn').addEventListener('click', (ev)=>{
      ev.preventDefault();
      localStorage.removeItem('wc_user');
      localStorage.removeItem('wc_token');
      // optionally clear online flag
      localStorage.removeItem('wc_online');
      // redirect to login
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>