<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WireConnect — Dashboard</title>
  <style>
    :root{
      --bg:#f6f8fb; --card:#fff; --accent:#0b5cff; --muted:#6b7280;
      --surface:#ffffff; --shadow: 0 8px 30px rgba(16,24,40,0.06);
      --radius:12px;
    }

    /* Make the page occupy full viewport */
    html,body{height:100%;margin:0}
    body{
      height:100%;
      font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;
      background:var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      flex-direction:column;
    }

    /* Header always at top, main fills remaining space */
    header{
      display:flex;
      align-items:center;
      gap:12px;
      padding:12px;
      box-sizing:border-box;
      width:100%;
      background:transparent;
    }

    /* Logo stretches to take available width (keeps menu to the right) */
    .logo{
      flex:1;
      display:flex;
      align-items:center;
      gap:12px;
      background:linear-gradient(135deg,#0b5cff,#55a7ff);
      border-radius:10px;
      padding:8px 12px;
      color:white;
      box-shadow:0 8px 24px rgba(11,92,255,0.08);
      min-height:56px;
      box-sizing:border-box;
    }
    .logo img{height:40px;}

    .menu-btn{
      width:54px;height:54px;border-radius:10px;border:0;background:#0b5cff;color:white;
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 18px rgba(11,92,255,0.12);cursor:pointer;font-weight:700;
      flex:0 0 auto;
    }

    /* Main area stretches to fill the rest of the screen */
    main{
      flex:1 1 auto;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      width:100%;
      box-sizing:border-box;
      padding:14px;
      overflow:hidden; /* child will scroll */
    }

    /* Centered page card that is also full-height scrollable */
    .card {
      width:100%;
      max-width:980px;              /* keeps desktop layout centered and tidy */
      height:100%;
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    /* inner content scroll area */
    .content {
      flex:1 1 auto;
      overflow:auto;
      padding-right:6px; /* small breathing room for scrollbar */
    }

    /* content blocks */
    .section{background:var(--surface);border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 6px 20px rgba(16,24,40,0.04)}
    .section h3{margin:0 0 6px;font-size:16px}
    .top-list{padding:8px 0}
    .top-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,#ffffff,#fbfcff);margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}

    /* Drawer / Menu */
    .drawer-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;z-index:1000}
    .drawer{position:fixed;right:0;top:0;height:100%;width:360px;max-width:92vw;background:white;box-shadow:-16px 0 40px rgba(2,6,23,0.12);transform:translateX(100%);transition:transform .28s ease;z-index:1001;padding:18px;box-sizing:border-box}
    .drawer.open{transform:translateX(0)}
    .drawer .header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .logo-small{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#0b5cff,#55a7ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .drawer a{display:block;padding:12px;border-radius:8px;color:#0b0b0b;text-decoration:none;margin-bottom:8px;border:1px solid #f1f5f9;background:#fbfdff}
    .drawer .primary{background:linear-gradient(90deg,#0b5cff,#55a7ff);color:white;border:0}
    .drawer .muted{font-size:13px;color:var(--muted)}
    .toggle-row{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:8px 0}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:#eef3ff;color:var(--accent)}

    /* small helper layout for the top greeting */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:12px;
    }

    /* accessibility and small screens */
    @media(max-width:720px){
      .logo img{height:34px}
      .drawer{width:92vw}
      .card{border-radius:12px;padding:12px}
    }

    /* nice thin scrollbar for desktop */
    .content::-webkit-scrollbar{width:8px}
    .content::-webkit-scrollbar-thumb{background:rgba(11,92,255,0.12);border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="logo" role="banner" aria-label="WireConnect">
      <!-- exact logo you provided -->
      <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="WireConnect logo">

    <button id="menuBtn" class="menu-btn" aria-label="Open menu">☰</button>
  </header>

  <main>
    <section class="card" role="main" aria-labelledby="dashboardHeading">
      <!-- top bar + greeting -->
      <div class="topbar">
        <div>
          <div id="dashboardHeading" style="font-size:18px;font-weight:700">Welcome back</div>
          <div class="muted" id="userGreeting">Tech — set up your profile</div>
        </div>
        <div class="badge" id="statusBadge" aria-live="polite">Offline</div>
      </div>

      <!-- scrollable area -->
      <div class="content">
        <section class="section" aria-labelledby="ann">
          <h3 id="ann">Announcements</h3>
          <div class="muted">No new announcements</div>
        </section>

        <section class="section" aria-labelledby="news">
          <h3 id="news">Articles & News</h3>
          <div class="muted">Latest industry news will appear here.</div>
        </section>

        <section class="section" aria-labelledby="toptech">
          <h3 id="toptech">Top Technicians</h3>
          <div class="top-list" id="leaderboard">
            <div class="top-item"><strong>Ezeh Bonk</strong><div class="muted">Count: 0</div></div>
          </div>
        </section>

        <div class="muted" style="padding:10px 6px">Quick actions (Go Online/Offline, Profile & KYC, Settings, Quotations) are available inside the Menu (top-right).</div>
      </div>
    </section>
  </main>

  <!-- Drawer / Menu -->
  <div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-label="Main menu">
    <div class="header">
      <div class="logo-small" aria-hidden="true">
        <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="" style="height:28px;object-fit:contain">
      </div>
      <div>
        <div style="font-weight:700">Quick Menu</div>
        <div class="muted" id="drawerUser">Technician</div>
      </div>
    </div>

    <nav>
      <a href="quotations.html" id="quotationsLink">Quotations</a>
      <a href="profile.html" id="profileLink">Profile & KYC</a>
      <a href="settings.html" id="settingsLink">Settings</a>

      <div style="height:8px"></div>

      <div class="toggle-row" style="align-items:center;">
        <div>
          <div style="font-weight:600">Availability</div>
          <div class="muted">Go online to receive job requests</div>
        </div>
        <div>
          <button id="toggleOnlineBtn" class="primaryToggle" style="padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:white;cursor:pointer">Go Online</button>
        </div>
      </div>

      <div style="height:10px"></div>
      <div class="muted">Other actions</div>
      <a href="#" id="logoutBtn" style="background:#fff;border:1px solid #f1f5f9">Logout</a>

      <div style="height:14px"></div>
      <div class="muted" id="drawerFeedback" style="font-size:13px"></div>
    </nav>
  </aside>

  <script>
    // DOM refs
    const menuBtn = document.getElementById('menuBtn');
    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('drawerBackdrop');
    const toggleOnlineBtn = document.getElementById('toggleOnlineBtn');
    const statusBadge = document.getElementById('statusBadge');
    const drawerFeedback = document.getElementById('drawerFeedback');
    const drawerUser = document.getElementById('drawerUser');
    const userGreeting = document.getElementById('userGreeting');

    // Endpoint (update if needed)
    const STATUS_ENDPOINT = 'https://wireconnet-1.onrender.com/api/technician/status';

    // open / close drawer
    function openDrawer(){
      drawer.classList.add('open');
      backdrop.style.display = 'block';
      drawer.setAttribute('aria-hidden','false');
      backdrop.setAttribute('aria-hidden','false');
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      backdrop.style.display = 'none';
      drawer.setAttribute('aria-hidden','true');
      backdrop.setAttribute('aria-hidden','true');
    }
    menuBtn.addEventListener('click', openDrawer);
    backdrop.addEventListener('click', closeDrawer);

    // load user from localStorage
    function loadUser(){
      try {
        const raw = localStorage.getItem('wc_user');
        if(raw){
          const u = JSON.parse(raw);
          drawerUser.textContent = u.fullname || u.username || 'Technician';
          userGreeting.textContent = (u.fullname ? u.fullname : u.username) + ' — ready to work';
        } else {
          drawerUser.textContent = 'Technician';
        }
      } catch(e){ console.warn('Could not load user', e); }
    }

    // UI state setter
    function setOnlineUI(isOnline){
      statusBadge.textContent = isOnline ? 'Online' : 'Offline';
      statusBadge.style.background = isOnline ? '#ecfff5' : 'transparent';
      statusBadge.style.color = isOnline ? '#037a50' : 'var(--muted)';
      toggleOnlineBtn.textContent = isOnline ? 'Go Offline' : 'Go Online';
      toggleOnlineBtn.style.background = isOnline ? '#fff' : 'var(--accent)';
      toggleOnlineBtn.style.color = isOnline ? 'var(--accent)' : '#fff';
      toggleOnlineBtn.style.border = isOnline ? '1px solid #e6eef9' : '0';
    }

    async function updateOnlineStatus(on){
      setOnlineUI(on);
      drawerFeedback.textContent = (on ? 'Trying to take jobs...' : 'You will not receive jobs while offline.');
      localStorage.setItem('wc_online', on ? '1' : '0');

      const token = localStorage.getItem('wc_token');
      try {
        const resp = await fetch(STATUS_ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...(token ? { 'Authorization': 'Bearer ' + token } : {})
          },
          body: JSON.stringify({ online: !!on }),
        });
        if(resp.ok){
          drawerFeedback.textContent = on ? 'You are now online — waiting for job requests.' : 'You are now offline.';
        } else {
          const text = await resp.text().catch(()=>null);
          drawerFeedback.textContent = 'Server response: ' + (text || resp.statusText);
        }
      } catch(err){
        console.warn('Status update failed', err);
        drawerFeedback.textContent = 'Network: could not notify server (saved locally).';
      }
    }

    toggleOnlineBtn.addEventListener('click', ()=>{
      const current = localStorage.getItem('wc_online') === '1';
      updateOnlineStatus(!current);
    });

    // initialize
    (function init(){
      loadUser();
      const onlineFlag = localStorage.getItem('wc_online') === '1';
      setOnlineUI(onlineFlag);
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeDrawer(); });
    })();

    // logout
    document.getElementById('logoutBtn').addEventListener('click', (ev)=>{
      ev.preventDefault();
      localStorage.removeItem('wc_user');
      localStorage.removeItem('wc_token');
      localStorage.removeItem('wc_online');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>