<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WireConnect — Dashboard</title>
  <style>
    :root{
      --bg:#f6f8fb;
      --accent:#0b5cff;
      --muted:#6b7280;
      --card:#ffffff;
    }
    html,body{height:100%;margin:0}
    body{font-family:Inter, "Segoe UI", Roboto, Arial; background:var(--bg); color:#111827}
    .container{max-width:1100px;margin:0 auto}
    /* banner covers the whole top */
    .banner{
      width:100%;
      height:140px;
      background:linear-gradient(135deg,#0b5cff,#55a7ff);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      border-bottom-left-radius:12px;
      border-bottom-right-radius:12px;
      box-shadow:0 8px 24px rgba(11,92,255,0.08);
    }
    .banner img{width:100%;height:100%;object-fit:cover;display:block}
    /* small top row below banner for title / menu */
    .top-row{display:flex;align-items:center;justify-content:space-between;padding:12px 14px}
    .title{font-weight:700;font-size:18px;margin:0;padding-left:6px}
    .menu-btn{background:#0b5cff;color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    main{padding:16px}
    .card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 8px 30px rgba(16,24,40,0.04)}
    .section-title{font-weight:700;margin-bottom:8px}
    .muted{color:var(--muted)}
    /* slide-over (right) full-screen overlay */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;
      z-index:1400;
    }
    .panel{
      position:fixed;right:0;top:0;height:100vh;width:100%;max-width:420px;background:#fff;
      box-shadow:-10px 0 40px rgba(2,6,23,0.16);
      transform:translateX(100%);transition:transform .22s ease;overflow:auto;
      z-index:1500;
      -webkit-overflow-scrolling: touch;
      pointer-events:auto;
    }
    .panel.open{transform:translateX(0)}
    .panel-header{display:flex;justify-content:space-between;align-items:center;padding:14px;border-bottom:1px solid #eef2f7}
    .panel-body{padding:14px}
    .panel .link{display:block;padding:10px;border-radius:8px;margin-bottom:10px;background:#fafafa;border:1px solid #f1f5f9;color:#111;text-decoration:none}
    .panel .action{display:block;padding:12px;border-radius:8px;background:var(--accent);color:#fff;text-align:center;border:0;margin-bottom:10px;cursor:pointer}
    .panel .muted{font-size:13px;color:var(--muted)}
    /* responsive */
    @media(min-width:900px){
      .container{padding:18px}
      .banner{height:160px}
      .panel{max-width:420px}
    }
    @media(max-width:520px){
      .banner{height:120px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- banner (covers whole top) -->
    <div class="banner" aria-hidden="true">
      <img src="https://i.postimg.cc/ZRSK3pJx/IMG-20260202-144108.png" alt="WireConnect banner">
    </div>

    <!-- top row: title + menu button (menu will open from right and cover screen) -->
    <div class="top-row" role="region" aria-label="Top controls">
      <h1 class="title" id="welcomeTitle">WireConnect — Dashboard</h1>
      <button id="openMenu" class="menu-btn" aria-haspopup="true" aria-expanded="false">☰ Menu</button>
    </div>

    <main>
      <section class="card">
        <div class="section-title">Announcements</div>
        <div class="muted">No announcements yet.</div>
      </section>

      <section class="card">
        <div class="section-title">Articles & News</div>
        <div class="muted">No articles published.</div>
      </section>

      <section class="card">
        <div class="section-title">Top Technicians</div>
        <div><strong id="leaderName">Ezeh Bonk</strong><div class="muted">Count: 0</div></div>
      </section>

      <!-- other page content continues below -->
      <section class="card">
        <div class="section-title">Recent Activity</div>
        <div class="muted">No activity yet.</div>
      </section>
    </main>
  </div>

  <!-- overlay + right panel -->
  <div id="overlay" class="overlay" tabindex="-1" aria-hidden="true"></div>

  <aside id="panel" class="panel" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="panel-header">
      <div style="font-weight:700">Menu</div>
      <div>
        <button id="closePanel" style="background:#f1f5f9;border:0;padding:8px 10px;border-radius:8px;cursor:pointer">Close</button>
      </div>
    </div>
    <div class="panel-body">
      <!-- LOGOUT link added ABOVE Book Job as requested -->
      <a href="#" id="logoutLink" class="link" style="background:#fff;border:1px solid #f1f5f9;color:#d23b3b;font-weight:700">Logout</a>

      <!-- Book Job (below logout) -->
      <a href="book.html" id="menuBook" class="link" style="background:linear-gradient(90deg,#0b5cff,#55a7ff);color:#fff;border:0">Book Job</a>

      <button id="goOnlineBtn" class="action">Go Online / Go Offline</button>

      <a href="profile.html" class="link" id="menuProfile">Profile & KYC</a>

      <a href="#" class="link" id="menuBookings">My Bookings</a>

      <a href="#" class="link" id="menuAnnouncements">Announcements</a>

      <a href="#" class="link" id="menuArticles">Articles & News</a>

      <hr style="margin:12px 0">

      <button id="openSettings" class="link" style="background:#fff;text-align:left">Settings</button>

      <div style="margin-top:18px">
        <a href="login.html" class="link">Sign out (alt)</a>
      </div>
    </div>
  </aside>

  <!-- settings modal (simple) -->
  <div id="settingsModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:1600;align-items:center;justify-content:center">
    <div style="background:#fff;padding:18px;border-radius:10px;max-width:420px;margin:20px;box-shadow:0 16px 40px rgba(2,6,23,0.25)">
      <h3>Settings</h3>
      <div style="margin-top:8px">
        <a href="#" id="changePW">Change password</a><br/>
        <a href="#" id="twoFA">Two-factor auth (not implemented)</a><br/>
        <a href="forgot_password.html" id="forgotPW" style="color:var(--accent)">Forgot password?</a>
      </div>
      <div style="margin-top:12px;text-align:right">
        <button id="closeSettings" style="background:#eef2ff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer">Close</button>
      </div>
    </div>
  </div>

  <script>
    // DOM refs
    const openMenu = document.getElementById('openMenu');
    const panel = document.getElementById('panel');
    const overlay = document.getElementById('overlay');
    const closePanel = document.getElementById('closePanel');
    const settingsModal = document.getElementById('settingsModal');
    const logoutLink = document.getElementById('logoutLink');
    const menuBook = document.getElementById('menuBook');
    const welcomeTitle = document.getElementById('welcomeTitle');
    const leaderboardName = document.getElementById('leaderName');

    // open / close panel
    function openPanel(){
      panel.classList.add('open');
      overlay.style.display = 'block';
      panel.setAttribute('aria-hidden','false');
      overlay.setAttribute('aria-hidden','false');
      openMenu.setAttribute('aria-expanded','true');
      // lock scroll
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
    }
    function closePanelFn(){
      panel.classList.remove('open');
      overlay.style.display = 'none';
      panel.setAttribute('aria-hidden','true');
      overlay.setAttribute('aria-hidden','true');
      openMenu.setAttribute('aria-expanded','false');
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    }

    openMenu.addEventListener('click', openPanel);
    closePanel.addEventListener('click', closePanelFn);
    overlay.addEventListener('click', closePanelFn);

    // show user fullname in header if available
    (function loadUser(){
      try {
        const raw = localStorage.getItem('wc_user') || localStorage.getItem('user');
        if(raw){
          const u = typeof raw === 'string' ? JSON.parse(raw) : raw;
          const name = u.fullname || u.username || u.email || u.phone || 'Welcome';
          welcomeTitle.textContent = 'Welcome back — ' + name;
        } else if(localStorage.getItem('userId')){
          welcomeTitle.textContent = 'Welcome back';
        }
      } catch(e){
        console.warn('loadUser error', e);
      }
    })();

    // availability toggle (client-side demo + optional backend call)
    const goBtn = document.getElementById('goOnlineBtn');
    let online = localStorage.getItem('wc_online') === '1';

    function setOnlineUI(){
      goBtn.textContent = online ? 'Go Offline' : 'Go Online';
      goBtn.style.background = online ? '#fff' : 'linear-gradient(90deg,#0b5cff,#55a7ff)';
      goBtn.style.color = online ? '#0b5cff' : '#fff';
      goBtn.style.border = online ? '1px solid #e6eef9' : '0';
    }
    setOnlineUI();

    // optional: notify backend about status (send techId if present)
    async function notifyBackendStatus(isOnline){
      const techId = localStorage.getItem('userId') || (function(){
        try { const u = JSON.parse(localStorage.getItem('wc_user')||'null'); return u && u.id ? u.id : null; } catch(e){ return null; }
      })();
      if(!techId) return; // nothing to send if no id

      try{
        await fetch('https://wireconnet-1.onrender.com/api/tech/status', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ techId, online: !!isOnline })
        });
      }catch(e){
        console.warn('notify backend failed', e);
      }
    }

    goBtn.addEventListener('click', async ()=> {
      online = !online;
      // save locally
      localStorage.setItem('wc_online', online ? '1' : '0');
      setOnlineUI();
      // attempt to notify backend (non-blocking)
      notifyBackendStatus(online).then(()=>{/*ok*/}).catch(()=>{/*ignore*/});
    });

    // settings open/close
    document.getElementById('openSettings').addEventListener('click', ()=>{
      settingsModal.style.display = 'flex';
      settingsModal.querySelector('div').focus?.();
    });
    document.getElementById('closeSettings').addEventListener('click', ()=> settingsModal.style.display = 'none');

    // LOGOUT behavior added: clear session keys and redirect to login.html
    logoutLink.addEventListener('click', (ev) => {
      ev.preventDefault();
      // clear session / login-related keys
      try {
        localStorage.removeItem('wc_user');
        localStorage.removeItem('wc_token');
        localStorage.removeItem('wc_online');
        localStorage.removeItem('userId');
        // also remove any other keys you use for session
        // localStorage.removeItem('some_other_key');

        // close panel then redirect
        closePanelFn();
        // small delay so panel closes visually
        setTimeout(()=> {
          window.location.href = 'login.html';
        }, 120);
      } catch(err){
        console.warn('logout error', err);
        window.location.href = 'login.html';
      }
    });

    // For safety: "Sign out (alt)" link also clears on click (keeps behavior consistent)
    const altSignOut = document.querySelector('.panel-body a[href="login.html"]');
    if(altSignOut){
      altSignOut.addEventListener('click', (ev)=>{
        ev.preventDefault();
        try {
          localStorage.removeItem('wc_user');
          localStorage.removeItem('wc_token');
          localStorage.removeItem('wc_online');
          localStorage.removeItem('userId');
        } catch(e){}
        window.location.href = 'login.html';
      });
    }

    // Ensure keyboard ESC closes panel/modal
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        if(settingsModal.style.display === 'flex'){ settingsModal.style.display = 'none'; }
        if(panel.classList.contains('open')){ closePanelFn(); }
      }
    });
  </script>
</body>
</html>